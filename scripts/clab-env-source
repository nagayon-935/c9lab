#!/usr/bin/ bash

usage() {
  cat <<'USAGE' >&2
usage:
  source clab-env-source [-f .env]
USAGE
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  usage
  exit 2
fi

# 初期値設定
ENV_FILE=".env"
OPTIND=1

while getopts ":f:h" opt; do
  case "${opt}" in
    f) ENV_FILE="${OPTARG}" ;;
    h) usage; return 0 ;;
    \?) usage; return 2 ;;
  esac
done
shift $((OPTIND - 1))

if [[ ! -f "${ENV_FILE}" ]]; then
  echo "env file not found: ${ENV_FILE}" >&2
  # 変数を掃除して終了
  unset ENV_FILE OPTIND opt
  return 2
fi

set -a
. "${ENV_FILE}"
set +a

# 使用した変数を削除
unset ENV_FILE OPTIND opt
